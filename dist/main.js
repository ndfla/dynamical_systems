(()=>{"use strict";class t{static create(t,a,i){const e=document.createElement(a);return void 0!==t&&t.appendChild(e),this.update(e,i),e}static update(t,a){if(void 0!==a)for(let i of Object.keys(a))t[i]=a[i]}}class a{constructor(a,i,e){this.target=a,this.data={},this.container=t.create(i,"div",e)}createText(a){const i=t.create(this.container,"div"),e=t.create(i,"p",{id:a.id});e.className="lead",e.innerHTML=a.info+" : <b>"+String(this.target.param[a.info])+"</b>",this.data[a.info]=e}update(){for(let t of Object.keys(this.data))this.data[t].innerHTML=t+" : <b>"+String(Math.round(this.target.param[t]*10**5)/10**5)+"</b>"}}const i=function(t){var a=t.clientWidth,i=t.clientHeight;t.width==a&&t.height==i||(t.width=a,t.height=i)};class e{constructor(a,i,e){this.target=a,this.sliderData={},this.container=t.create(i,"div",e)}createSlider(){const a=t.create(this.container,"div"),i=t.create(a,"h5",{className:"lead"});return[t.create(a,"input",{type:"range"}),i]}initialize(a){const[i,e]=this.createSlider();t.update(i,{id:"id"in a?a.id:"slider",min:0,max:a.step,value:a.step/(a.max-a.min)*(this.target.param[a.var]-a.min)}),e.innerHTML=a.info+": <b>"+String(this.target.param[a.var])+"</b>",i.addEventListener("input",(t=>{const i=Math.round(1e3*((a.max-a.min)*t.target.value/a.step+a.min))/1e3;this.target.param[a.var]=i,e.innerHTML=a.info+": <b>"+String(i)+"</b>",this.target.plot()})),this.sliderData[a.var]={object:i,info:e,data:a}}update(t){const a=this.sliderData[t].object,i=this.sliderData[t].info,e=this.sliderData[t].data;a.value=Math.round(e.step*(this.target.param[e.var]-e.min)/(e.max-e.min)*1e3)/1e3,i.innerHTML=e.info+": <b>"+String(this.target.param[t])+"</b>"}}const n=(t,a,i,e,n)=>{let s=n*i(t,a),r=n*i(t+s/2,a+s/2),h=n*i(t+r/2,a+r/2);return(s+2*r+2*h+n*i(t+h,a+h))/6},s=(t,a)=>t.map(((t,i)=>t*a(i))).reduce(((t,a)=>t+a),0),r=([-36799/120960,295767/120960,-1041723/120960,2102243/120960,-2664477/120960,2183877/120960,-1152169/120960,434241/120960].reverse(),[-475/1440,2877/1440,-7298/1440,9982/1440,-7923/1440,4277/1440].reverse()),h=([t,a],[i,e],n,h,o,c)=>{const m=[];for(let h=0;h<c;h++){const h=t+o*s(r,(t=>n[t][0])),c=a+o*s(r,(t=>n[t][1]));[t,a]=[h,c],m.push([t,a]),n.unshift([i(t,a),e(t,a)]),n.pop()}return m},o=(t,a)=>180*Math.atan2(t,a)/Math.PI,c=(t,a,i)=>t<i&&i<a,m=(t,a,i,e,n,s)=>{const r=t,h=a,m=Math.sign(e);for(let e=0;e<s;e++){let p=.5*(t+a);const l=o(n(a)-n(p),i/2**(e+1)),d=o(n(p)-n(t),i/2**(e+1));if(l==d)break;if([t,a]=-1==m?l>d?[t,p]:[p,a]:l<d?[t,p]:[p,a],1==m&&c(n(r),n(h),n(p)))break;if(-1==m&&c(n(h),n(r),n(p)))break;if(e==s-1){let[i,e]=[n(t),n(a)];return[[t,i],"discontinuity",[a,e]]}}return 0};class p{constructor(t,a){this.context=t,this.width=t.canvas.width,this.height=t.canvas.height,this.aspect=this.height/this.width,t.canvas.style.backgroundColor=void 0!==a?a:"black"}}class l{#t;constructor(t){this.canvas=new p(t.context,t.backgroundColor),this.#t=t.initwidth,this.param={magnification:void 0===t.magnification?1:t.magnification,centerX:void 0===t.center?0:t.center.x,centerY:void 0===t.center?0:t.center.y,scaleX:void 0===t.scale?1:t.scale.x,scaleY:void 0===t.scale?1:t.scale.y}}get width(){return this.#t/2**(this.param.magnification-1)}get scaledWidth(){return this.width/this.param.scaleX}get scaledHeight(){return this.width*this.canvas.aspect/this.param.scaleY}getCoordFromCanvas(t,a){return[t=this.param.centerX+this.scaledWidth*(t/this.canvas.width-.5),a=this.param.centerY+this.scaledHeight*(.5-a/this.canvas.height)]}}class d{constructor(t){this.coord=new l(t),this.param=this.coord.param,this.canvas=this.coord.canvas}get width(){return this.coord.scaledWidth}get height(){return this.coord.scaledHeight}getCoordFromCanvas(t,a){return this.coord.getCoordFromCanvas(t,a)}moveCenter(t,a){[this.param.centerX,this.param.centerY]=this.getCoordFromCanvas(t,a)}}class g{constructor(t){this.camera=t,this.canvas=t.canvas,this.param=t.param}get pixelLengthX(){return this.canvas.width/this.camera.width}get pixelLengthY(){return this.canvas.height/this.camera.height}coordToCanvasX(t){return this.canvas.width*(.5+(t-this.param.centerX)/this.camera.width)}coordToCanvasY(t){return this.canvas.height*(.5-(t-this.param.centerY)/this.camera.height)}localPoint(t,a,i,e="red"){this.canvas.context.fillStyle=e,t=this.coordToCanvasX(t),a=this.coordToCanvasY(a),this.canvas.context.beginPath(),this.canvas.context.arc(t,a,i,0,2*Math.PI),this.canvas.context.fill()}point(t,a,i="white"){const e=this.camera.width/2,n=this.camera.height/2;t>this.param.centerX+e||t<this.param.centerX-e||a>this.param.centerY+n||a<this.param.centerY-n||(this.canvas.context.fillStyle="white",t=this.coordToCanvasX(t),a=this.coordToCanvasY(a),this.canvas.context.fillRect(t,a,1,1))}line(t,a,i,e,n="gray",s=1){t=this.coordToCanvasX(t),a=this.coordToCanvasY(a),i=this.coordToCanvasX(i),e=this.coordToCanvasY(e),a=Math.abs(a)>2*this.canvas.height?2*Math.sign(a)*this.canvas.height:a,e=Math.abs(e)>2*this.canvas.height?2*Math.sign(e)*this.canvas.height:e,this.canvas.context.strokeStyle=n,this.canvas.context.lineWidth=s,this.canvas.context.beginPath(),this.canvas.context.moveTo(t,a),this.canvas.context.lineTo(i,e),this.canvas.context.stroke()}rect(t,a,i,e){this.canvas.context.fillStyle="black";const n=this.coordToCanvasX(t),s=this.coordToCanvasY(a);i=this.coordToCanvasX(t+i)-n,e=s-this.coordToCanvasY(a+e),this.canvas.context.fillRect(Math.max(n,0),Math.max(s,0),Math.min(i+Math.min(n,0),this.canvas.width),Math.min(e+Math.min(s,0),this.canvas.height))}diff(t,a){return i=>(t(i+a)-t(i-a))/(2*a)}grid(){const t=this.camera.width<50?1:5*10**Math.floor(Math.log10(this.camera.width/5)-1),a=this.param.centerX-this.camera.width/2,i=this.param.centerY-this.camera.height/2;let e=Math.floor(a)-Math.floor(a)%t,n=Math.floor(i)-Math.floor(i)%t;for(;e<=a+this.camera.width;)0==e?this.line(e,i,e,i+this.camera.height,"darkred"):this.line(e,i,e,i+this.camera.height),e+=t;for(;n<=i+this.camera.height;)0==n?this.line(a,n,a+this.camera.width,n,"darkred"):this.line(a,n,a+this.camera.width,n),n+=t}id(){const t=(t,a)=>t-a,a=1/this.pixelLengthX,i=1/this.pixelLengthY;let e=this.param.centerX-.5*this.camera.width;console.log(a,i,e);for(let n=0;n<this.canvas.width;n++){const n=e-.5*a,s=e+.5*a;let r=this.param.centerY+.5*this.camera.height;for(let a=0;a<this.canvas.height;a++){const a=r-.5*i,h=r+.5*i,o=Math.sign(t(n,a)),c=Math.sign(t(s,a)),m=Math.sign(t(n,h)),p=Math.sign(t(s,h));o==c&&m==p&&o==m||this.point(e,r),r-=i}e+=a}}explicit(t){const a="ghostwhite",i=((t,a,i,e)=>{let n=[];for(let s=0;s<e;s++){if(s>=1){const e=o(t(i)-n[n.length-1][1],a);if(Math.abs(e)>30){const s=m(n[n.length-1][0],i,a,e,t,200);"object"==typeof s&&(n=n.concat(s))}}n.push([i,t(i)]),i+=a}return n})(t,1/this.pixelLengthX,this.param.centerX-.5*this.camera.width,this.canvas.width);for(let t=0;t<i.length-1;t++)"discontinuity"!=i[t+1]&&"discontinuity"!=i[t]&&this.line(i[t][0],i[t][1],i[t+1][0],i[t+1][1],a,3);"discontinuity"!=i[i.length-2]&&this.line(i[i.length-2][0],i[i.length-2][1],i[i.length-1][0],i[i.length-1][1],a,3)}}class f{constructor(t){this.camera=new d(t),this.draw=new g(this.camera),this.canvas=this.camera.canvas,this.param=this.camera.param,this.param.iteration=t.iteration,this.param.threshold=t.threshold,this.param.initx=t.initx,this.param.sample="sample"in t?t.sample:this.canvas.width,this.map=t.map,this.param.domain=t.domain}get width(){return this.camera.width}get height(){return this.camera.height}normalizeSample(t){return this.param.centerX+(t/this.param.sample-.5)*this.width}getCoordFromCanvas(t,a){return this.camera.getCoordFromCanvas(t,a)}moveCenter(t,a){this.camera.moveCenter(t,a)}plot(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw.grid();for(let t=0;t<this.param.sample;t++){let a=this.param.initx;const i=this.normalizeSample(t);if(void 0===this.param.domain||this.param.domain(i))for(let t=0;t<this.param.iteration;t++)a=this.map(i,a),t>=this.param.iteration-this.param.threshold&&this.draw.point(i,a)}}}class v{constructor(t){this.camera=new d(t),this.draw=new g(this.camera),this.canvas=this.camera.canvas,this.param=this.camera.param,this.param.initx=t.initx,this.param.inity=t.inity,this.param.length=t.length,this.param.sample=t.sample,this.param.fx=t.fx,this.param.fy=t.fy,this.param.h=t.h,this.param.domain=t.domain}get width(){return this.camera.width}get height(){return this.camera.height}normalizeSample(t){return this.param.centerX+(t/this.param.sample-.5)*this.width}getCoordFromCanvas(t,a){return this.camera.getCoordFromCanvas(t,a)}moveCenter(t,a){this.camera.moveCenter(t,a)}plot(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw.grid();let t=((t,a,i,e,s,r,o)=>{const c=((t,a,i,e,s,r,h)=>{const o=[t,a],c=[],m=[],p=200;for(let s=0;s<600;s++){const h=t+n(t,a,i,0,r/p),o=a+n(t,a,e,0,r/p);[t,a]=[h,o],s%p==199&&c.push([t,a])}t=o[0],a=o[1];for(let s=0;s<600;s++){const h=t+n(t,a,i,0,-r/p),o=a+n(t,a,e,0,-r/p);[t,a]=[h,o],s%p==199&&m.push([t,a])}return m.reverse().push(o),m.concat(c)})(t,a,i,e,0,r);c.length;const m=h(c[c.length-1],[i,e],c.slice(-6,c.length).reverse().map(((t,a)=>[i(t[0],t[1]),e(t[0],t[1])])),0,r,o),p=h(c[0],[i,e],c.slice(0,6).map(((t,a)=>[i(t[0],t[1]),e(t[0],t[1])])),0,-r,o);return p.reverse(),p.concat(c.concat(m))})(this.param.initx,this.param.inity,this.param.fx,this.param.fy,0,this.param.h,this.param.sample);for(let a=0;a<t.length-1;a++)this.draw.line(t[a][0],t[a][1],t[a+1][0],t[a+1][1],"white");this.draw.localPoint(this.param.initx,this.param.inity,3)}}class x{constructor(t){this.camera=new d(t),this.draw=new g(this.camera),this.canvas=this.camera.canvas,this.param=this.camera.param,this.param.iteration=t.iteration,this.param.a=t.a,this.param.x=t.x,this.param.sample=t.sample,this.map=t.map,this.param.transparency=t.transparency}get width(){return this.camera.width}get height(){return this.camera.height}normalizeSample(t){return this.param.centerX+(t/this.param.sample-.5)*this.width}getCoordFromCanvas(t,a){return this.camera.getCoordFromCanvas(t,a)}moveCenter(t,a){this.camera.moveCenter(t,a)}plot(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw.grid();const t=t=>this.map(this.param.a,t);this.draw.explicit((t=>t)),this.draw.explicit((a=>t(a))),this.draw.localPoint(this.param.x,0,3);let a=this.param.x,i=0;for(let e=0;e<this.param.iteration;e++){const e=t(a);this.draw.line(a,i,a,e,`rgba(255,127,80, ${this.param.transparency})`,2),this.draw.line(a,e,e,e,`rgba(255,127,80, ${this.param.transparency})`,2),a=e,i=e}}}const w={DDS:t=>new f(t),VF:t=>new v(t),CW:t=>new x(t)},u=n=>{const s=document.getElementById("page");s.innerHTML="";const r=t.create(s,"section",{id:"header",className:"text-wrap"});if("title"in n&&(t.create(r,"h1",{className:"display-5"}).innerHTML=n.title),"equation"in n&&((t,a,i="Large",e=1)=>{const n=katex.renderToString("\\"+i+"{"+t+"}",{displayMode:e,throwOnError:!1});a.innerHTML+=n})(n.equation,r),"UIcontainer"in n&&"canvas"in n.UIcontainer){const r=t.create(s,"section",{id:"UIcontainer"}),[h,o]=function(t){const a=document.createElement("canvas");return t.appendChild(a),i(a),[a,a.getContext("2d")]}(r),c=n.UIcontainer.canvas.data;c.context=o;const m=w[n.UIcontainer.canvas.type](c),p=new a(m,r,{id:"text-container",className:"row row-cols-2 rounded"}),l=new e(m,r,{id:"slider-container",className:"row row-cols-2 rounded"});for(let t in n.UIcontainer.slider)n.UIcontainer.slider[t].var=t,l.initialize(n.UIcontainer.slider[t]);for(let t of n.UIcontainer.text)void 0===m.param[t]&&(m.param[t]=0),p.createText({info:t});h.addEventListener("wheel",(t=>{t.preventDefault(),t.deltaY<=-100?(m.moveCenter(t.offsetX,t.offsetY),m.param.magnification+=1):t.deltaY>=100&&(m.moveCenter(t.offsetX,t.offsetY),m.param.magnification-=1),m.plot(),l.update("magnification"),p.update()})),h.addEventListener("pointerdown",(t=>{t.preventDefault(),m.moveCenter(t.offsetX,t.offsetY),m.plot(),p.update()})),h.addEventListener("pointermove",(t=>{t.preventDefault();const[a,i]=m.getCoordFromCanvas(t.offsetX,t.offsetY);m.param.pointerX=Math.round(a*10**5)/10**5,m.param.pointerY=Math.round(i*10**5)/10**5,p.update()})),h.addEventListener("touchmove",(t=>{t.preventDefault()})),window.addEventListener("resize",(()=>{i(h),m.canvas.width=h.width,m.canvas.height=h.height,m.plot()})),m.plot()}},C={logisticMapBifurcation:{title:"bifurcation diagram of the logistic map",equation:"x_{n+1} = ax_n(1 - x_n)",UIcontainer:{canvas:{type:"DDS",data:{initwidth:12,iteration:100,threshold:20,initx:.5,map:(t,a)=>t*a*(1-a)}},text:["centerX","pointerX","centerY","pointerY"],slider:{magnification:{info:"magnification",min:-5,max:40,step:45},initx:{info:"initial x",min:-2,max:2,step:400},sample:{info:"sample",min:100,max:1e3,step:9},iteration:{info:"iteration",min:10,max:1e3,step:99},threshold:{info:"threshold",min:1,max:200,step:199},scaleY:{info:"scaleY",min:.5,max:5,step:45}}}},logisticMapCobweb:{title:"cobweb plot of the logistic map",equation:"x_{n+1} = ax_n(1 - x_n)",UIcontainer:{canvas:{type:"CW",data:{initwidth:12,magnification:2,a:-1.7,x:.2,iteration:100,transparency:.5,map:(t,a)=>t*a*(1-a)}},text:["centerX","pointerX","centerY","pointerY"],slider:{magnification:{info:"magnification",min:-5,max:40,step:45},a:{info:"a",min:-4.5,max:4.5,step:400},x:{info:"x",min:-2,max:2,step:100},iteration:{info:"iteration",min:10,max:1e3,step:99},scaleY:{info:"scaleY",min:.5,max:5,step:45},transparency:{info:"line transparency",min:.1,max:1,step:9}}}},tentMapBifurcation:{title:"bifurcation diagram of the tent map",equation:"\n\n        x_{n+1} = \\begin{cases} \n            ax_n & x_n < \\frac{1}{2}, \\\\\n            a(1 - x_n) & x_n \\ge \\frac{1}{2},\n        \\end{cases}",UIcontainer:{canvas:{type:"DDS",data:{initwidth:12,iteration:100,threshold:20,initx:.5,map:(t,a)=>t*Math.min(a,1-a)}},text:["centerX","pointerX","centerY","pointerY"],slider:{magnification:{info:"magnification",min:-5,max:40,step:45},initx:{info:"initial x",min:-.2,max:1.2,step:140},sample:{info:"sample",min:100,max:1e3,step:9},iteration:{info:"iteration",min:10,max:1e3,step:99},threshold:{info:"threshold",min:1,max:200,step:199},scaleY:{info:"scaleY",min:.5,max:5,step:45}}}},tentMapCobweb:{title:"cobweb plot of the tent map",equation:"\n        x_{n+1} = \\begin{cases} \n            ax_n & x_n < \\frac{1}{2}, \\\\\n            a(1 - x_n) & x_n \\ge \\frac{1}{2},\n        \\end{cases}",UIcontainer:{canvas:{type:"CW",data:{initwidth:12,magnification:2,a:-1.7,x:.2,iteration:100,transparency:.5,map:(t,a)=>t*Math.min(a,1-a)}},text:["centerX","pointerX","centerY","pointerY"],slider:{magnification:{info:"magnification",min:-5,max:40,step:45},a:{info:"a",min:-4.5,max:4.5,step:400},x:{info:"x",min:-2,max:2,step:100},iteration:{info:"iteration",min:10,max:1e3,step:99},scaleY:{info:"scaleY",min:.5,max:5,step:45},transparency:{info:"line transparency",min:.1,max:1,step:9}}}},nonlinearODE1:{title:"orbit of nonlinear ODE",equation:"\n\n        \\begin{cases} \n            x^{\\prime} = y \\\\\n            y^{\\prime} = \\sin(x)\n        \\end{cases}",UIcontainer:{canvas:{type:"VF",data:{initwidth:12,sample:400,h:.1,initx:1,inity:0,fx:(t,a)=>a,fy:(t,a)=>Math.sin(t)}},text:["centerX","pointerX","centerY","pointerY"],slider:{magnification:{info:"magnification",min:-5,max:40,step:45},initx:{info:"initial x",min:-3*Math.PI,max:3*Math.PI,step:400},inity:{info:"initial y",min:-3*Math.PI,max:3*Math.PI,step:400},sample:{info:"sample",min:100,max:1e3,step:9},h:{info:"h",min:.01,max:.1,step:9},scaleY:{info:"scaleY",min:.5,max:5,step:45}}}}};(()=>{const t=new URLSearchParams(window.location.search).get("page");u(t in C?C[t]:C.logisticMapBifurcation)})();for(let t in C)document.getElementById(t).addEventListener("click",(()=>{const a=new URL(window.location);a.searchParams.set("page",t),window.history.replaceState({},"",a),u(C[t])}))})();